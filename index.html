<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Mayoyao Genealogy Archive</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        :root { 
            --primary: #2d5a27; /* Forest Green */
            --secondary: #a0522d; /* Terracotta */
            --light: #f8f9fa;
            --dark: #1a1a1a;
        }

        body { font-family: 'Inter', -apple-system, sans-serif; margin: 0; background-color: var(--light); color: var(--dark); }

        /* HERO HEADER */
        .hero {
            position: relative;
            height: 450px;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            color: white;
            /* REPLACE 'your-image-url.jpg' with your actual image link */
            background: linear-gradient(rgba(0, 0, 0, 0.4), rgba(0, 0, 0, 0.4)), 
                        url('https://drive.google.com/file/d/1b3wJYfG0Zvh6SC-3i6o7xcquQEIbso7q/view?usp=sharing') no-repeat center center/cover;
            box-shadow: inset 0 -100px 100px -50px rgba(0,0,0,0.5);
        }

        .hero-content h1 {
            font-size: 3rem;
            margin: 0;
            text-transform: uppercase;
            letter-spacing: 6px;
            font-weight: 800;
            text-shadow: 2px 2px 10px rgba(0,0,0,0.5);
        }

        .hero-content p {
            font-size: 1.1rem;
            letter-spacing: 2px;
            opacity: 0.9;
            margin-top: 10px;
            font-weight: 300;
        }

        /* NAVIGATION TABS */
        nav {
            display: flex;
            justify-content: center;
            background: white;
            padding: 0;
            position: sticky;
            top: 0;
            z-index: 1000;
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
        }

        nav button {
            background: none;
            border: none;
            padding: 20px 25px;
            cursor: pointer;
            font-weight: 600;
            color: #666;
            text-transform: uppercase;
            font-size: 0.8rem;
            letter-spacing: 1px;
            transition: 0.3s;
            border-bottom: 3px solid transparent;
        }

        nav button:hover { color: var(--primary); }
        nav button.active { 
            color: var(--primary); 
            border-bottom: 3px solid var(--primary);
        }

        /* VIEWS & SEARCH */
        .view { display: none; max-width: 1000px; margin: 40px auto; padding: 0 20px; animation: fadeIn 0.6s ease; }
        .view.active { display: block; }

        .search-container { text-align: center; margin-bottom: 40px; }
        .search-box {
            width: 100%;
            max-width: 500px;
            padding: 15px 25px;
            border-radius: 50px;
            border: 2px solid #eee;
            font-size: 1rem;
            outline: none;
            transition: 0.3s;
        }
        .search-box:focus { border-color: var(--primary); box-shadow: 0 5px 15px rgba(0,0,0,0.05); }

        /* CLAN CARDS */
        .clan-card {
            background: white;
            border-radius: 12px;
            margin-bottom: 20px;
            border: 1px solid #eaeaea;
            overflow: hidden;
            transition: 0.3s;
        }
        .clan-header {
            padding: 20px 25px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: #fff;
            font-weight: 700;
            color: var(--primary);
        }
        .clan-header:hover { background: #fcfcfc; }
        .clan-body { display: none; padding: 20px 25px; border-top: 1px solid #f9f9f9; }
        .clan-card.open .clan-body { display: block; }

        /* TREE NODES */
        .node { margin: 10px 0; }
        .person {
            display: inline-block;
            padding: 10px 18px;
            background: #fff;
            border: 1px solid #eee;
            border-radius: 8px;
            border-left: 4px solid var(--secondary);
            font-size: 0.95rem;
        }
        .tag { font-size: 0.7rem; color: #999; margin-left: 10px; font-weight: 400; }
        .branch { margin-left: 35px; border-left: 2px solid #f0f0f0; padding-left: 20px; }
        .found { background: #fff9e6 !important; border-color: #f39c12 !important; transform: scale(1.02); }

        /* DASHBOARD */
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; }
        .stat-card { background: white; padding: 30px; border-radius: 12px; text-align: center; border-bottom: 4px solid var(--primary); }
        .stat-card h2 { font-size: 2.5rem; margin: 0; color: var(--secondary); }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>

<div class="hero">
    <div class="hero-content">
        <h1>Mayoyao Family Roots</h1>
        <p>Connecting Generations Across the Terraces</p>
    </div>
</div>

<nav>
    <button onclick="tab('about')">Our Story</button>
    <button onclick="tab('stats')">Community</button>
    <button onclick="tab('tree')" id="defaultTab">Genealogy</button>
    <button onclick="tab('privacy')">Privacy</button>
</nav>

<div id="about" class="view">
    <div class="stat-card" style="text-align: left;">
        <h2 style="font-size: 1.5rem;">Preserving the Heritage</h2>
        <p>This digital archive serves the people of Mayoyao by tracking lineages from 1945 to present. It is a tool for cultural preservation and family connection.</p>
    </div>
</div>

<div id="stats" class="view">
    <div class="stats-grid" id="statsGrid"></div>
</div>

<div id="tree" class="view">
    <div class="search-container">
        <input type="text" class="search-box" id="search" placeholder="Search for a name...">
    </div>
    <div id="treeContent">Loading records...</div>
</div>

<div id="privacy" class="view">
    <p style="text-align: center; color: #666;">Data is maintained according to local community guidelines. Contact the LGU for record updates.</p>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
<script>
    const SHEET_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQHFdKL2QwhK8oAgG3gntgIxT5xSFzNj4cznnPYPzbP_qeCG8Q8DvVGcLox8gceV6S1yef5tgtIdwcw/pub?output=csv";
    
    function tab(id) {
        document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
        document.querySelectorAll('nav button').forEach(b => b.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        event.target.classList.add('active');
    }
    document.getElementById('defaultTab').click();

    Papa.parse(SHEET_URL, {
        download: true, header: true, skipEmptyLines: true,
        complete: (res) => processData(res.data)
    });

    function processData(data) {
        const map = new Map();
        const children = new Set();
        
        data.forEach(p => {
            if(p.ID) {
                const id = p.ID.trim();
                map.set(id, { ...p, ID: id, children: [] });
            }
        });

        data.forEach(p => {
            const id = p.ID.trim();
            [p["Father ID"], p["Mother ID"]].forEach(pid => {
                if(pid && map.has(pid.trim())) {
                    const parent = map.get(pid.trim());
                    if(!parent.children.some(c => c.ID === id)) parent.children.push(map.get(id));
                    children.add(id);
                }
            });
        });

        const clans = {};
        map.forEach((person, id) => {
            if(!children.has(id)) {
                const cName = person.Clan || "General";
                if(!clans[cName]) clans[cName] = [];
                clans[cName].push(person);
            }
        });

        render(clans, data);
    }

    function render(clans, raw) {
        const out = document.getElementById("treeContent");
        out.innerHTML = "";
        
        Object.keys(clans).sort().forEach(cName => {
            const card = document.createElement('div');
            card.className = 'clan-card';
            card.innerHTML = `<div class="clan-header" onclick="this.parentElement.classList.toggle('open')"><span>${cName} Clan</span><span>+</span></div><div class="clan-body"></div>`;
            const body = card.querySelector('.clan-body');
            clans[cName].forEach(root => body.appendChild(createNode(root)));
            out.appendChild(card);
        });

        document.getElementById('statsGrid').innerHTML = `
            <div class="stat-card"><h2>${raw.length}</h2><p>People</p></div>
            <div class="stat-card"><h2>${Object.keys(clans).length}</h2><p>Clans</p></div>
        `;

        setupSearch();
    }

    function createNode(p) {
        const div = document.createElement('div');
        div.className = "node";
        div.setAttribute('data-name', p["Full Name"].toLowerCase());
        div.innerHTML = `<div class="person"><strong>${p["Full Name"]}</strong><span class="tag">${p.Barangay || ''}</span></div>`;
        if(p.children.length > 0) {
            const b = document.createElement('div');
            b.className = "branch";
            p.children.forEach(c => b.appendChild(createNode(c)));
            div.appendChild(b);
        }
        return div;
    }

    function setupSearch() {
        document.getElementById('search').addEventListener('input', (e) => {
            const val = e.target.value.toLowerCase();
            document.querySelectorAll('.person').forEach(p => p.classList.remove('found'));
            if(val.length < 2) return;
            document.querySelectorAll(`.node[data-name*="${val}"]`).forEach(m => {
                m.querySelector('.person').classList.add('found');
                let parent = m.parentElement;
                while(parent) {
                    if(parent.classList.contains('clan-card')) parent.classList.add('open');
                    parent = parent.parentElement;
                }
            });
        });
    }
</script>
</body>
</html>
