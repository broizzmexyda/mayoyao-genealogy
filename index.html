<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Mayoyao Genealogy Project</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
  #family-tree h3 {
  margin-top: 30px;
  color: #333;
  font-size: 20px;
}

#family-tree h4 {
  margin-top: 15px;
  color: #555;
  font-size: 16px;
  margin-left: 20px;
}

.person {
  border: 1px solid #ddd;
  padding: 10px 14px;
  background: #ffffff;
  border-radius: 8px;
  display: inline-block;
  margin-top: 8px;
}

.children {
  margin-left: 40px;
  margin-top: 6px;
  display: flex;
  flex-direction: column;
  gap: 6px;
}

    body {
      font-family: Arial, sans-serif;
      background: #f8f9fa;
      color: #222;
      margin: 0;
      padding: 0;
    }
    header {
      background: #ffffff;
      padding: 24px;
      text-align: center;
      border-bottom: 1px solid #ddd;
    }
    main {
      max-width: 900px;
      margin: 40px auto;
      padding: 0 20px;
    }
    h1 {
      margin: 0;
      font-size: 28px;
    }
    p {
      line-height: 1.6;
    }
    footer {
      text-align: center;
      font-size: 14px;
      color: #666;
      margin: 40px 0;
    }
  </style>
</head>
<body>

<header>
  <h1>Mayoyao Genealogy Project</h1>
  <p>Public Digital Family Records (1945–Present)</p>
</header>

<main>
  <h2>About the Project</h2>
  <p>
    This website serves as a public digital archive of family
    genealogy records in the Municipality of Mayoyao.
    The project is community-based and continuously updated.
  </p>

<h2>Family Tree by Barangay & Clan</h2>
<div id="family-tree"></div>

</main>

<footer>
  © LGU Mayoyao • Genealogy Project
</footer>
<script>
const sheetURL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQHFdKL2QwhK8oAgG3gntgIxT5xSFzNj4cznnPYPzbP_qeCG8Q8DvVGcLox8gceV6S1yef5tgtIdwcw/pub?output=csv";

fetch(sheetURL)
  .then(res => res.text())
  .then(csv => {
    const rows = csv.split("\n").slice(1);
    const people = [];

    // Parse CSV
    rows.forEach(row => {
      if (!row.trim()) return;
      const cols = row.split(",");
      people.push({
        id: cols[0],
        name: cols[1],
        birth: cols[2],
        death: cols[3],
        barangay: cols[4],
        clan: cols[5],
        notes: cols[6],
        father: cols[7] || null,
        mother: cols[8] || null,
        children: []
      });
    });

    // Link children to parents
    const peopleById = {};
    people.forEach(p => peopleById[p.id] = p);
    people.forEach(p => {
      if (p.father && peopleById[p.father]) peopleById[p.father].children.push(p);
      if (p.mother && peopleById[p.mother]) peopleById[p.mother].children.push(p);
    });

    // Group by Barangay → Clan
    const treeContainer = document.querySelector("#family-tree");
    const barangays = {};

    people.forEach(p => {
      if (!barangays[p.barangay]) barangays[p.barangay] = {};
      if (!barangays[p.barangay][p.clan]) barangays[p.barangay][p.clan] = [];
      if (!p.father && !p.mother) barangays[p.barangay][p.clan].push(p);
    });

    // Create DOM nodes
    function createNode(person) {
      const div = document.createElement("div");
      div.className = "person";
      div.innerHTML = `<strong>${person.name}</strong><br>${person.birth || ""} - ${person.death || ""}<br>${person.notes || ""}`;

      if (person.children.length) {
        const childrenDiv = document.createElement("div");
        childrenDiv.className = "children";
        person.children.forEach(c => childrenDiv.appendChild(createNode(c)));
        div.appendChild(childrenDiv);
      }

      return div;
    }

    for (const barangay in barangays) {
      const bDiv = document.createElement("div");
      const bTitle = document.createElement("h3");
      bTitle.textContent = barangay;
      bDiv.appendChild(bTitle);

      for (const clan in barangays[barangay]) {
        const cDiv = document.createElement("div");
        const cTitle = document.createElement("h4");
        cTitle.textContent = clan;
        cDiv.appendChild(cTitle);

        barangays[barangay][clan].forEach(rootPerson => {
          cDiv.appendChild(createNode(rootPerson));
        });

        bDiv.appendChild(cDiv);
      }

      treeContainer.appendChild(bDiv);
    }
  });
</script>

</body>
</html>
